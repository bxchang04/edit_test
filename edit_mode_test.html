<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Edit mode test</title>
    <link rel="stylesheet" href="edit.css">
</head>
<body>
  <div id="canvas" class="canvas">
    <div class="browser item editable"> <!--browser-->
      <div class="browser__header">
        <h2 class="browser__title">Webpage title</h2>
        <svg class="icon"><use href="#icon-minus"></use></svg>
        <svg class="icon"><use href="#icon-square"></use></svg>
        <svg class="icon"><use href="#icon-close"></use></svg>
      </div>

      <div class="browser__toolbar">
        <svg class="icon"><use href="#icon-arrow-left"></use></svg>
        <svg class="icon"><use href="#icon-arrow-right"></use></svg>
        <svg class="icon"><use href="#icon-refresh"></use></svg>
        <input type="search" class="browser__search" placeholder="https://">
        <svg class="icon"><use href="#icon-ellipsis-vertical"></use></svg>
      </div>
    </div>
  </div>

</body>
</html>

<script>
// Note: Add user-select: none to a master CSS class(?)

// Add class: Editable (don't use forEach).

// BUGS -- can delete child elements. Fix -- disable editing (read only? Esp. for icons) for child divs. Increases overhead to set up div attributes.
  // Alternative solution: Enable some kind of read-only mode (doesn't exist), or clone the contents and edit that, then paste it back in. Or another more effective solution?

// Edit mode - Handle mouse click input
document.getElementById('canvas').onclick = event => {
   if (event.detail === 1) {
     // Register single click. Single click on canvas should exit edit. BUG -- this single click should blur but doesn't.
     if(document.activeElement === document.getElementById('canvas')){
        exitEdit(); // this function is buggy
     }
   } else if (event.detail === 2) {
     // Register double click.
     if(event.target && event.target.closest(".editable")) {
       console.log("List item ", event.target.classList, " was clicked!");
       enterEdit();
     }
   }
};



// Edit mode - Handle keyboard input
document.addEventListener("keydown", handleInput);

function handleInput(e) {
  if(event.key === "F2" || event.key === "Enter" && event.key !== "Control" ){ //BUG -- doesn't work.
    console.log("Enter edit mode");
    e.preventDefault(); // to prevent Enter from creating a new div (bug?)
    enterEdit();
  }

  // This should cancel edits as well -- improve this.
  if(event.key === "Escape"){
    console.log("Exit edit mode");
    exitEdit();
  }

  //BUG -- CTRL+Enter to exit edit mode does not work.
  if(event.key === "Control"){
    if(event.key === "Enter"){
      console.log("Exit edit mode");
      exitEdit();
    }
  }

  // Add if CTRL+Enter, exitEdit
}

// Toggle edit mode. TEST -- does this work for SVGs?
function enterEdit(e) {
  console.log("edit");
  document.activeElement.contentEditable = true;
  document.activeElement.focus();
}

// Blur behavior. Will this work for SVGs?
function exitEdit() {
  console.log("blur");
  document.activeElement.contentEditable = false;
  document.activeElement.blur();
  //BUG -- but hitting F2 or enter still works
}

// next steps
// test moveable with edit
// Test moveable's keybinding and click binding system
</script>
